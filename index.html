<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Group Date Cafe Quiz</title>
</head>
<body>

<div id="quiz-container">
    <div id="question"></div>
    <div id="answers"></div>
    <div id="result"></div>
</div>

<script>
const questionGroups = {
    starter: {
        questionText: "Does a difference in age or sex not matter as long as there is love?",
        answers: [
            { text: "Their sex matters", group: "group2A" },
            { text: "It doesn't matter at all!", group: "group2B" }
        ]
    },

    group2A: [
        {
            questionText: "What's your idea of a good time together?",
            answers: [
                { text: "Definitely outdoors!", group: "group3" },
                { text: "Positively indoors!", group: "group1" }
            ]
        }
    ],

    group2B: [
        {
            questionText: "How do you want the person you like to act towards you?",
            answers: [
                { text: "Make a bold move on me", group: "group2" },
                { text: "Make a modest move on me", group: "group4" }
            ]
        }
    ],

    group1: [
        {
            questionText: "What kind of club would you be interested in joining?",
            answers: [
                { text: "The Gardening Club", person: null },
                { text: "The Diving Club", person: null },
                { text: "The Technology Club", person: "Fuuka Yamagishi" }
            ]
        },
        {
            questionText: "What kind of older lady do you like?",
            answers: [
                { text: "One talented at lame jokes", person: "Margaret" },
                { text: "One good at looking after others", person: null },
                { text: "One who's actually an older man", person: null }
            ]
        },
        {
            questionText: "That girl you're curious about dropped something. What was it?",
            answers: [
                { text: "A floral-pattern handkerchief", person: null },
                { text: "A lacy parasol", person: null },
                { text: "Some handwritten poetry", person: "Marie" }
            ]
        },
        {
            questionText: "What surprised you about the one you fell in love with?",
            answers: [
                { text: "They're a crane, not a human", person: null },
                { text: "They're a girl, not a prince", person: "Naoto Shirogane" }
            ]
        },
        {
            questionText: "What do you live on?",
            answers: [
                { text: "Rice", person: null },
                { text: "Bread", person: null },
                { text: "Donuts", person: "Rei" }
            ]
        },
        {
            questionText: "Where would you go to soothe your weary soul?",
            answers: [
                { text: "A hot springs inn", person: "Yukiko Amagi" },
                { text: "An extravagant resort", person: null },
                { text: "A mountain cabin", person: null }
            ]
        },
    ],

    group1NineTen: [
        {
            questionText: "What you look for in a woman is...",
            answers: [
                { text: "A keen-eyed, shy Japanese girl", person: "Yukiko Amagi" },
                { text: "A sensitive, literary sort", person: "Marie" },
                { text: "Someone mysterious in a sleek car", person: "Margaret" },
                { text: "Something else...", person: null }
            ]
        },
        {
            questionText: "What kind of girl makes your heart skip a beat?",
            answers: [
                { text: "Someone reserved and considerate", person: "Fuuka Yamagishi" },
                { text: "Overwhelming intellect", person: "Naoto Shirogane" },
                { text: "A healthy appetite", person: "Rei" },
            ]
        }
    ],

    group2: [
        {
            questionText: "What's the number one topping for beef bowls?",
            answers: [
                { text: "Red pickled ginger", person: null },
                { text: "Protein", person: "Akihiko Sanada" },
                { text: "Green onions", person: null }
            ]
        },
        {
            questionText: "All together now:",
            answers: [
                { text: "\"Let's go have some fun!\"", person: null },
                { text: "\"Even the ace detective gives up!\"", person: "Junpei Iori" }
            ]
        },
        {
            questionText: "What's the most important accompaniment for food?",
            answers: [
                { text: "A tall glass of milk", person: "Ken Amada" },
                { text: "Warm green tea", person: null },
                { text: "Mad Bull", person: null },
                { text: "Someone to eat with", person: null }
            ]
        },
        {
            questionText: "What do you most seek comfort in?",
            answers: [
                { text: "Relaxing music", person: null },
                { text: "Massages", person: null },
                { text: "Squishy dog pads", person: "Koromaru" }
            ]
        },
        {
            questionText: "What's in your refrigerator?",
            answers: [
                { text: "Dinner leftovers", person: null },
                { text: "Cold barley tea", person: null },
                { text: "Some kind of grass", person: "Yu Narukami" }
            ]
        },
        {
            questionText: "What is the primary characteristic of a cute girl?",
            answers: [
                { text: "A lovely smile", person: null },
                { text: "She wears glasses", person: null },
                { text: "Makes bear puns", person: "Teddie" }
            ]
        },
    ],

    group2NineTen: [
        {
            questionText: "What you look for in a man is...",
            answers: [
                { text: "A great sense of humor", person: "Junpei Iori" },
                { text: "Well-honed muscles", person: "Akihiko Sanada" },
                { text: "Rock-solid reliability", person: "Yu Narukami" },
                { text: "Something else...", person: null }
            ]
        },
        {
            questionText: "What kind of girl makes your heart skip a beat?",
            answers: [
                { text: "Youth that tries to act mature", person: "Ken Amada" },
                { text: "A pure heart", person: "Teddie" },
                { text: "Overwhelming adorableness", person: "Koromaru" },
            ]
        }
    ],

    group3: [
        {
            questionText: "Which would you choose?",
            answers: [
                { text: "The Voluptuous Abaddon", person: null },
                { text: "A titanium-bodied beauty", person: "Aigis" }
            ]
        },
        {
            questionText: "You're feeling a bit hungry... What do you reach for?",
            answers: [
                { text: "A rice ball", person: null },
                { text: "Meat gum", person: "Chie Satonaka" }
            ]
        },
        {
            questionText: "What makes her charming?",
            answers: [
                { text: "The way she runs up an escalator", person: "Elizabeth" },
                { text: "The way animals eat her food scraps", person: null },
                { text: "Her taking home my electronics", person: null }
            ]
        },
        {
            questionText: "Someone you like gave you a compliment. What did they say?",
            answers: [
                { text: "You're amazing!", person: null },
                { text: "You're so cool!", person: null },
                { text: "C'est magnifique!", person: "Mitsuru Kirijo" }
            ]
        },
        {
            questionText: "What do you like to do to liven things up?",
            answers: [
                { text: "Play King's Game at a club", person: "Rise Kujikawa" },
                { text: "Singing contests at karaoke", person: null },
                { text: "Arcade tournaments", person: null },
                { text: "Read at a library", person: null }
            ]
        },
        {
            questionText: "If you were going to master something, it'd definitely be this!",
            answers: [
                { text: "Calligraphy", person: null },
                { text: "Flower arrangement", person: null },
                { text: "Archery", person: "Yukari Takeba" }
            ]
        },

    ],

    group3NineTen: [
        {
            questionText: "What you look for in a woman is...",
            answers: [
                { text: "Brains and beauty", person: "Mitsuru Kirijo" },
                { text: "An invincible idol smile", person: "Rise Kujikawa" },
                { text: "Polite and proper behaviour", person: "Elizabeth" },
                { text: "Something else...", person: null }
            ]
        },
        {
            questionText: "What kind of girl makes your heart skip a beat?",
            answers: [
                { text: "Sharp-tongued, yet lonely", person: "Yukari Takeba" },
                { text: "An energetic crybaby", person: "Chie Satonaka" },
                { text: "Abs of literal steel", person: "Aigis" },
            ]
        }
    ],

    group4: [
        {
            questionText: "What is the best place for some alone time?",
            answers: [
                { text: "Relaxing at a cafe", person: null },
                { text: "A thrilling amusement park", person: null },
                { text: "Hands-on at a bath house", person: "Kanji Tatsumi" }
            ]
        },
        {
            questionText: "Are you starting to get tired of these questions?",
            answers: [
                { text: "Not really", person: null },
                { text: "Maybe", person: null },
                { text: "I don't care", person: "Makoto Yuki" }
            ]
        },
        {
            questionText: "What movies make you cry?",
            answers: [
                { text: "War films", person: null },
                { text: "Tragic romances", person: null },
                { text: "Incredible Pet Stories", person: "Shinjiro Aragaki" }
            ]
        },
        {
            questionText: "If you could be reborn into another family, what would your role be?",
            answers: [
                { text: "Older brother to sisters", person: null },
                { text: "Younger brother of sisters", person: "Theodore" },
                { text: "A trustworthy sister", person: null }
            ]
        },
        {
            questionText: "How would you express your feelings to the one you like?",
            answers: [
                { text: "Tell them in person", person: null },
                { text: "Slug it out at a riverbed", person: "Yosuke Hanamura" },
                { text: "Something else...", person: null }
            ]
        },
        {
            questionText: "Oh no! Your beloved is in danger!",
            answers: [
                { text: "Rush over at once", person: null },
                { text: "Level your bowgun", person: "Zen" },
                { text: "Stand back and watch", person: null }
            ]
        },

    ],

    group4NineTen: [
        {
            questionText: "What you look for in a man is...",
            answers: [
                { text: "A motherly, caring side", person: "Shinjiro Aragaki" },
                { text: "A cool, but wild side", person: "Makoto Yuki" },
                { text: "Skilled hands", person: "Kanji Tatsumi" },
                { text: "Something else...", person: null }
            ]
        },
        {
            questionText: "What kind of girl makes your heart skip a beat?",
            answers: [
                { text: "Somewhat disappointing good looks", person: "Yosuke Hanamura" },
                { text: "A knight who protects the weak", person: "Zen" },
                { text: "A gentle youngest of siblings", person: "Theodore" },
            ]
        }
    ],

    randomQuestions: [
    {
        questionText: "You've upset your beloved! How will you make it up to them?",
        answers: [
            { text: "Apologize profusely", group: "random" },
            { text: "Butter them up with gifts", group: "random" },
            { text: "Get angry and dodge the issue", group: "random" }
        ]
    },
    {
        questionText: "In your next life, would you rather be a man or a woman?",
        answers: [
            { text: "Definitely a Man", group: "random" },
            { text: "A woman, obviously", group: "random" }
        ]
    },
    {
        questionText: "Which would you rather be inside?",
        answers: [
            { text: "A shark tank", group: "random" },
            { text: "A lion cage", group: "random" }
        ]
    },
    {
        questionText: "Clothing, food, or housing: which would you spend money on first?",
        answers: [
            { text: "Definitely clothing", group: "random" },
            { text: "Positively food", group: "random" },
            { text: "Absolutely housing", group: "random" }
        ]
    },
    {
        questionText: "If you had to eat one or the other, which would it be?",
        answers: [
            { text: "A plate of wasabi", group: "random" },
            { text: "A plate of sugar", group: "random" }
        ]
    },
    {
        questionText: "Which kind of prize would you want to win?",
        answers: [
            { text: "One gigantic one", group: "random" },
            { text: "Recurring small prizes", group: "random" }
        ]
    },
    {
        questionText: "What's the first thing you get in line for at the amusement park?",
        answers: [
            { text: "Screaming roller coasters", group: "random" },
            { text: "Romantic merry-go-rounds", group: "random" },
            { text: "Whirling tea cups", group: "random" }
        ]
    },
    {
        questionText: "What is your greatest weapon?",
        answers: [
            { text: "My dazzling smile", group: "random" },
            { text: "My passionate eyes", group: "random" },
            { text: "My conversational skills", group: "random" },
            { text: "My pure heart", group: "random" }
        ]
    },
    {
        questionText: "What do you do if someone you don't care for confesses their love?",
        answers: [
            { text: "Might as well date them", group: "random" },
            { text: "Start by being friends", group: "random" },
            { text: "Hesitantly turn them down", group: "random" },
            { text: "Bluntly reject them", group: "random" }
        ]
    },
    {
        questionText: "Your specialty dish is...",
        answers: [
            { text: "Curry", group: "random" },
            { text: "Meat and potatoes", group: "random" },
            { text: "Pickled mackerel", group: "random" }
        ]
    }
    ]
};


let currentGroupKey = 'starter';
let askedQuestions = new Set();
let finalCharacter = ''; 
let questionCount = 0;
const totalQuestions = 10;

function displayQuestion() {
    if (questionCount >= totalQuestions) {
        displayFinalOutput();
        return;
    }
    
    questionCount++;
    updateQuestionCounter();

    const group = questionGroups[currentGroupKey];
    let questionData;
    if (finalCharacter || currentGroupKey === 'randomQuestions') {
        questionData = getQuestionFromGroup('randomQuestions');
    } else {
        questionData = getQuestionFromGroup(currentGroupKey);
    }

    if (!questionData) {
        displayFinalOutput();
        return;
    }

    const questionContainer = document.getElementById('question');
    const answersContainer = document.getElementById('answers');
    questionContainer.innerHTML = `<h2>${questionData.questionText}</h2>`;
    answersContainer.innerHTML = ''; // Clear previous answers

    // Create buttons for each answer and attach event listeners
    questionData.answers.forEach(answer => {
        const button = document.createElement('button');
        button.textContent = answer.text;
        button.addEventListener('click', () => handleAnswer(answer));
        answersContainer.appendChild(button);
    });
}

function handleAnswer(answer) {
    if (answer.group) {
        currentGroupKey = answer.group;
    } else if (answer.person) {
        finalCharacter = answer.person;
        currentGroupKey = 'randomQuestions'; // Switch to random questions after determining finalCharacter
    }

    displayQuestion();
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
    }
}

function getQuestionFromGroup(groupKey) {
    let group = questionGroups[groupKey];
    let questionData;

    // Shuffle the questions if the group is an array and not the starter or 'randomQuestions' group
    if (Array.isArray(group) && groupKey !== 'starter' && groupKey !== 'randomQuestions') {
        shuffleArray(group);
    }

    if (Array.isArray(group)) {
        // Find the first question that hasn't been asked yet
        questionData = group.find(q => !askedQuestions.has(q.questionText));

        // If a question is found, mark it as asked
        if (questionData) askedQuestions.add(questionData.questionText);
    } else if (!askedQuestions.has(group.questionText)) {
        questionData = group;
        askedQuestions.add(group.questionText);
    }

    return questionData;
}

function updateQuestionCounter() {
    document.getElementById('question-counter').innerText = `Question ${questionCount} of ${totalQuestions}`;
}

const characterImageMap = {
    "Fuuka Yamagishi": "images/Fuuka_Yamagishi.gif",
    "Margaret": "images/Margaret.jpg",
    "Marie": "images/Marie.jpg",
    "Naoto Shirogane": "images/Naoto_Shirogane.jpg",
    "Rei": "images/Rei.jpg",
    "Yukiko Amagi": "images/Yukiko_Amagi.jpg",
    "Akihiko Sanada": "images/Akihiko_Sanada.jpg",
    "Junpei Iori": "images/Junpei_Iori.png",
    "Ken Amada": "images/Ken_Amada.jpg",
    "Koromaru": "images/Koromaru.jpg",
    "Yu Narukami": "images/Yu_Narukami.jpg",
    "Teddie": "images/Teddie.jpg",
    "Aigis": "images/Aigis.jpg",
    "Chie Satonaka": "images/Chie_Satonaka.jpg",
    "Elizabeth": "images/Elizabeth.jpg",
    "Mitsuru Kirijo": "images/Mitsuru_Kirijo.jpg",
    "Rise Kujikawa": "images/Rise_Kujikawa.jpg",
    "Yukari Takeba": "images/Yukari_Takeba.jpg",
    "Kanji Tatsumi": "images/Kanji_Tatsumi.jpg",
    "Makoto Yuki": "images/Makoto_Yuki.jpg",
    "Shinjiro Aragaki": "images/Shinjiro_Aragaki.jpg",
    "Theodore": "images/Theodore.jpg",
    "Zen": "images/Zen.jpg",
    "Yosuke Hanamura": "images/Yosuke_Hanamura.jpg"
};

function displayFinalOutput() {
    if (!finalCharacter && questionCount < 10) {
        // Directly specify what to display for question 9 based on currentGroupKey
        let questionText = '';
        let answers = [];
        
        // Example for group1, replicate for other groups with their specific question 9 content
        if (currentGroupKey.startsWith('group1')) {
            questionText = "What you look for in a woman is...";
            answers = [
                { text: "A keen-eyed, shy Japanese girl", person: "Yukiko Amagi" },
                { text: "A sensitive, literary sort", person: "Marie" },
                { text: "Someone mysterious in a sleek car", person: "Margaret" },
                { text: "Something else...", person: null }
            ];
        }
        // Add similar if-else blocks for other groups (group2, group3, group4) with their respective question 9 content

        // If question 9 was specifically set for this group, display it
        if (questionText && answers.length > 0) {
            const questionContainer = document.getElementById('question');
            const answersContainer = document.getElementById('answers');
            
            questionContainer.innerHTML = `<h2>${questionText}</h2>`;
            answersContainer.innerHTML = ''; // Clear previous answers
            
            // Populate the answers
            answers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer.text;
                button.addEventListener('click', () => handleAnswer(answer));
                answersContainer.appendChild(button);
            });

            // Ensure questionCount reflects showing question 9
            questionCount = 9;
            
            return; // Skip the rest of the final output logic
        }
    }

    // Update the question counter to show "Final Result" surrounded by heart emojis
    const questionCounter = document.getElementById('question-counter');
    questionCounter.innerHTML = `<h2>❤️ Final Result ❤️</h2>`;

    // Hide the question and answers from the display
    document.getElementById('question').style.display = 'none';
    document.getElementById('answers').style.display = 'none';

    // Display the final result in the result container
    const resultContainer = document.getElementById('result');
    const resultText = finalCharacter ? `Your result is: ${finalCharacter}!` : "No final character determined.";
    resultContainer.innerHTML = `<h2>${resultText}</h2>`;

    // Display the image for the final character, if one is determined
    if (finalCharacter) {
        const imagePath = characterImageMap[finalCharacter];
        if (imagePath) {
            const image = document.createElement('img');
            image.src = imagePath;
            image.alt = finalCharacter;
            resultContainer.appendChild(image);
        } else {
            console.log('No image found for ' + finalCharacter);
        }
    }
}

function displayQuestionFromGroup(groupKey, questionIndex) {
    // Fetch the specific question from the group
    const questionData = questionGroups[groupKey][questionIndex];

    // Set up the question and answers
    const questionContainer = document.getElementById('question');
    const answersContainer = document.getElementById('answers');

    questionContainer.innerHTML = `<h2>${questionData.questionText}</h2>`;
    answersContainer.innerHTML = ''; // Clear previous answers

    // Create buttons for each answer and attach the click event
    questionData.answers.forEach(answer => {
        const button = document.createElement('button');
        button.textContent = answer.text;
        button.addEventListener('click', () => {
            handleAnswer(answer);
        });
        answersContainer.appendChild(button);
    });

    // Make sure to update the question count and displayed state as needed
    questionCount++;
}

// Adding the question counter element dynamically
const quizContainer = document.getElementById('quiz-container');
const counterElement = document.createElement('div');
counterElement.id = 'question-counter';
quizContainer.insertBefore(counterElement, quizContainer.firstChild);

// Start the quiz
displayQuestion();
</script>

</body>
</html>