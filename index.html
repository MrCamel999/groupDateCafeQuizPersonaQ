<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Group Date Cafe Quiz</title>
</head>
<body>

<div id="quiz-container">
    <div id="question"></div>
    <div id="answers"></div>
    <div id="result"></div>
</div>

<script>
const questionGroups = {
    starter: {
        questionText: "Does a difference in age or sex not matter as long as there is love?",
        answers: [
            { text: "Their sex matters (go to 2A)", group: "group2A" },
            { text: "It doesn't matter at all! (go to 2B)", group: "group2B" }
        ]
    },
    group2A: [
        {
            questionText: "What's your idea of a good time together?",
            answers: [
                { text: "Definitely outdoors!", group: "group3" },
                { text: "Positively indoors!", group: "group1" }
            ]
        }
    ],
    group2B: [
        {
            questionText: "How do you want the person you like to act towards you?",
            answers: [
                { text: "Make a bold move on me", group: "group2" },
                { text: "Make a modest move on me", group: "group4" }
            ]
        }
    ],
    group1: [
        // Sample Group 1 Questions
        {
            questionText: "What kind of club would you be interested in joining?",
            answers: [
                { text: "The Gardening Club", person: "Fuuka" },
                { text: "The Diving Club", person: null },
                { text: "The Technology Club", person: null },
            ]
        },
        // More questions go here...
    ],
    // More groups go here...
    randomQuestions: [
        {
            questionText: "You've upset your beloved! How will you make it up to them?",
            answers: ["Apologize profusely", "Butter them up with gifts", "Get angry and dodge the issue"]
        },
        {
            questionText: "In your next life, would you rather be a man or a woman?",
            answers: ["Definitely a Man", "A woman, obviously"]
        },
        {
            questionText: "Which would you rather be inside?",
            answers: ["A shark tank", "A lion cage"]
        },
        {
            questionText: "Clothing, food, or housing: which would you spend money on first?",
            answers: ["Definitely clothing", "Positively food", "Absolutely housing"]
        },
        {
            questionText: "If you had to eat one or the other, which would it be?",
            answers: ["A plate of wasabi", "A plate of sugar"]
        },
        {
            questionText: "Which kind of prize would you want to win?",
            answers: ["One gigantic one", "Recurring small prizes"]
        },
        {
            questionText: "What's the first thing you get in line for at the amusement park?",
            answers: ["Screaming roller coasters", "Romantic merry-go-rounds", "Whirling tea cups"]
        },
        {
            questionText: "What is your greatest weapon?",
            answers: ["My dazzling smile", "My passionate eyes", "My conversational skills", "My pure heart"]
        },
        {
            questionText: "What do you do if someone you don't care for confesses their love?",
            answers: ["Might as well date them", "Start by being friends", "Hesitantly turn them down", "Bluntly reject them"]
        },
        {
            questionText: "Your specialty dish is...",
            answers: ["Curry", "Meat and potatoes", "Pickled mackerel"]
        }
    ]
};

let currentQuestionNumber = 1;
let currentGroup = null;
let askedQuestions = new Set();
let finalOutput = null;

function displayQuestion() {
    const questionData = currentGroup ? questionGroups[currentGroup][askedQuestions.size] : questionGroups.starter;
    const questionContainer = document.getElementById('question');
    const answersContainer = document.getElementById('answers');

    questionContainer.innerHTML = `<h2>Question ${currentQuestionNumber}</h2><p>${questionData.questionText}</p>`;
    answersContainer.innerHTML = questionData.answers.map((answer, index) => {
        return `<button onclick='handleAnswer(${JSON.stringify(answer)})'>${answer.text}</button>`;
    }).join('');
}

function handleAnswer(answer) {
    if (answer.group) {
        // Set the current group and show the first question of that group
        currentGroup = answer.group;
        displayNextGroupQuestion();
    } else {
        // Answer from a group question
        if (answer.person) {
            // A specific person was selected, determine final output
            finalOutput = answer.person;
            fillRemainingQuestionsWithRandom();
        } else {
            // No person was selected, continue with the group questions
            if (currentGroup && askedQuestions.size < 6) {
                // Still have questions left in the group
                displayNextGroupQuestion();
            } else {
                // Move on to the special question 9 after 6 questions
                if (currentQuestionNumber === 9) {
                    finalOutput = answer.person;
                    displayRandomQuestion();
                } else if (currentQuestionNumber === 10) {
                    finalOutput = answer.person;
                    displayFinalOutput();
                } else {
                    // We've finished the group questions, no specific person was selected
                    displaySpecialQuestion9();
                }
            }
        }
    }
}

function displayNextGroupQuestion() {
    let nextQuestionIndex;
    do {
        nextQuestionIndex = Math.floor(Math.random() * questionGroups[currentGroup].length);
    } while (askedQuestions.has(nextQuestionIndex));
    
    askedQuestions.add(nextQuestionIndex);
    currentQuestionNumber++;
    displayQuestion(questionGroups[currentGroup][nextQuestionIndex]);
}

function displayRandomQuestion() {
    let nextQuestionIndex;
    do {
        nextQuestionIndex = Math.floor(Math.random() * questionGroups.randomQuestions.length);
    } while (askedQuestions.has(nextQuestionIndex + 100)); // Adding 100 to distinguish random questions indexes

    askedQuestions.add(nextQuestionIndex + 100); // Track random questions separately
    currentQuestionNumber++;
    displayQuestion(questionGroups.randomQuestions[nextQuestionIndex]);
}

function displaySpecialQuestion9() {
    // Directly access question 9 and display it
    currentQuestionNumber++;
    displayQuestion(questionGroups.specialQuestion9);
}

function fillRemainingQuestionsWithRandom() {
    // If we have determined the final output before reaching question 10,
    // we still need to fill the remaining questions with random ones.
    while (currentQuestionNumber < 10) {
        displayRandomQuestion();
    }
    displayFinalOutput();
}

function displayFinalOutput() {
    const resultContainer = document.getElementById('result');
    resultContainer.innerHTML = finalOutput ? `Your result is: ${finalOutput}` : "No result found.";
    // Reset quiz or navigate to a different page
}

displayQuestion();
</script>

</body>
</html>